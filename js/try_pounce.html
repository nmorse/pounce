
<html>
  <head>
    <script src="dist/parser.js"></script>
    <script src="dist/runtime.js"></script>
    <script src="test/runtime_test.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    
    <style>
    body {
      font-family: "helvetica neue", roboto;
    }
      .box {
        border: lightgray solid 1px;
        margin: 1px 1px;
        padding: 0px 4px;
      }
      .col-container {
        display: flex;
        flex-flow: column wrap;
      }
      .row-container {
        display: flex;
        flex-flow: row nowrap;
        overflow-x: scroll;
      }
      .scroll {
         overflow-x: scroll;
      }
      td {
        vertical-align: top;
      }
    </style>
  </head>
    <body>
      <div class="" id="try_pounce">
        <canvas id="canvas" width="250" height="150"></canvas>
        <div class="col-container">
          <div class="row-container">
            <div class="box" style="min-width:100px;">
              Pounce
            </div>
            <div class="col-container">
              <div>
                &nbsp;<label for="runUpToCursor"><input id="runUpToCursor" v-on:change="focusEditor()" v-model="runUpToCursor" type="checkbox" />run Pounce only to cursor</label>
              </div>
              <div>
                <input v-model="ps" v-on:keyup="runPounce($event)" placeholder="Enter Pounce words here" spellcheck="false"
                   style="width:608px; margin:2px;" v-focus />
              </div>
            </div>
          </div>
          <div class="row-container">
            <div class="col-container box" style="min-width:100px;">
              <div v-for="ele in vs" class="box">
                {{ ele }} &nbsp;
              </div>
            </div>
              <!--
                <div class="col-container box" style="height:300px; width: 600px;">
                  <div v-for="(value, key) in words" class="box" style="width:100px;">
                    {{ key }}: {{ value.desc }}
                  </div>
                </div>
              -->
            <div class="row-container" style="min-height:300px;">
              <div v-for="h_instance in vs_history" class="col-container box">
                <!--
                -->
                <div v-for="pl_item in h_instance.pl" class="box" style="width:100px; background-color:rgba(200, 20, 20, 0.3);">
                  {{ pl_item }}&nbsp;
                </div>
                <div v-if="h_instance.term" class="box" style="width:100px; background-color:rgba(20, 20, 200, 0.3);">
                  {{ h_instance.term }}
                </div>
                <div v-for="item in h_instance.stack" class="box" style="width:100px;">
                  {{ item }}&nbsp;
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="examples_section">
        <button v-on:click="showExamples = !showExamples">toggle Runtime test results</button> check out {{ totalexamples }} examples.
        <table id="some_examples" v-show="showExamples">
          <tr v-for="t in examples">
            <td><a v-on:click="loadExample(t[0])"><code>{{t[0]}}</code></a></td>
            <td><code>{{t[1].level}}</code></td>
            <td>{{t[1].desc}}</td>
          </tr>
        </table>
      </div>
            <script src="ui/io_canvas_basic.js"></script>

      <script>
      
        function loadExample(s) {
          try_pounce.ps = s;
          try_pounce.runPounce();
          testing.showExamples = false;
        }
        var try_pounce = new Vue({
          el: '#try_pounce',
          data: {
            "ps": ""
          , "last_ps": ""
          , "pl": []
          , "vs": []
          , "vs_history": []
          , "words": words
          , "runUpToCursor": false
          },
          methods: {
           "runPounce": function (e) {
              if (this.runUpToCursor) {
                this.runPounceFromCursor(e);
              }
              else {
                if (this.ps !== this.last_ps) {
                  this.executePounceScript(this.ps);
                }
              }
            }
          , "runPounceFromCursor": function (e) {
              if (e && e.target) {
                //console.log(e.target.selectionStart, e.target.selectionEnd);
                //console.log(this.ps.slice(0, e.target.selectionStart));
                const new_ps = this.ps.slice(0, e.target.selectionStart);
                if (new_ps !== this.last_ps) {
                  this.executePounceScript(new_ps);
                }
              }
            }
          , "focusEditor" : function () {
              //this.focus();
              console.log('deadwood here?');
            }
          , "executePounceScript" : function (pounce_script) {
              if (this.scan_recall(pounce_script)) {
                return;
              }
              this.last_ps = pounce_script;
              this.vs_history = [];
              this.pl = parse(pounce_script);
              this.vs = run(this.pl, [], words, this.vs_history).reverse();
            }
          , 'scan_recall': function (ps) {
                if (ps.indexOf(' recall') >= 1) {
                  const pl = parse(ps);
                  if (pl.length === 2) {
                    let key = pl[0][0];
                    this.ps = '[' + unParse(words[key]) + '] [' + key + '] ';
                    this.vs = [];
                    return true;
                  }
                }
                return false;
              
              //      s.push('recall error: requested word is internal (i.e. defined as a function) and is not divisable into words');
            }
          },
          directives: {
            focus: {
              update: function(el) {
                Vue.nextTick(() => el.focus());
              }
            }
          }
        });
const examples = [
  ['2 3 +', {summary:'Sum of two numbers', desc:'Math is easy to do, the only difference is that the operator (+ for addition) comes after the two numbers being added.', level:'basic'}],
  ['2 3 *', {summary:'Simple Multiplication', desc:'For multiplication, the operator (* for the product or multiplication) is placed after the two numbers to be multiplied.', level:'basic'}],
  ['9 7 + 2.5 /', {summary:'Sum of two numbers', desc:'To add and then divide, say (9 + 7) / 2.4. Notice how no parenthases are needed when the operators are after the numbers. ', level:'basic'}],
  ['9 7 2.4 + /', {summary:'Sum of two numbers', desc:'To divide by a sum, say 9  / (7 + 2.4). Notice how no parenthases are needed when the operators are after the numbers. ', level:'basic'}],
  ['9 7 swap', {summary:'Sum of two numbers', desc:'To divide by a sum, say 9  / (7 + 2.4). Notice how no parenthases are needed when the operators are after the numbers. ', level:'basic'}],
  ['1 2 3 dup', {summary:'Sum of two numbers', desc:'To divide by a sum, say 9  / (7 + 2.4). Notice how no parenthases are needed when the operators are after the numbers. ', level:'basic'}],
  ['9 7 swap dup',{summary:'Sum of two numbers', desc:'To divide by a sum, say 9  / (7 + 2.4). Notice how no parenthases are needed when the operators are after the numbers. ', level:'basic'}],
  ['10 20 30 40 2 bubble-up',{summary:'Sum of two numbers', desc:'To divide by a sum, say 9  / (7 + 2.4). Notice how no parenthases are needed when the operators are after the numbers. ', level:'basic'}],
  ['cb-init cb-clear 4 7 41 162 cb-line 49 182 130 148 cb-line 50 50 cb-block',{summary:'Draws on the canvas', desc:'Draws lines and rectangles on the canvas as a drawing demo', level:'canvas'}]
];
        var examples_section = new Vue({
          el: '#examples_section',
          data: {
            "showExamples": false
          , "examples": examples
          , "totalexamples": examples.length
          , "loadExample": loadExample
          }
        });


      </script>

    </body>
</html>
